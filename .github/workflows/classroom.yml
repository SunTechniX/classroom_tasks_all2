name: Autograding Tests
on:
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    name: ÐžÑ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: "[TASK 01] Run tests"
        id: task_01
        run: python3 tools/run_task_tests.py task_01

      - name: "[TASK 02] Run tests"
        id: task_02
        run: python3 tools/run_task_tests.py task_02

      - name: "[TASK 03] Run tests"
        id: task_03
        run: python3 tools/run_task_tests.py task_03

      - name: âœ… Generate Final Summary
        env:
          TASK_01_RESULT: ${{ steps.task_01.outputs.result }}
          TASK_02_RESULT: ${{ steps.task_02.outputs.result }}
          TASK_03_RESULT: ${{ steps.task_03.outputs.result }}
        run: python3 tools/generate_summary.py task_01 task_02 task_03

      # ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² Classroom â€” Ð² ÑÑ‚Ð¾Ð¼ Ð¶Ðµ job'Ðµ!
      - name: ðŸ“¤ Report to GitHub Classroom
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          TASK_01_RESULTS: ${{ steps.task_01.outputs.result }}
          TASK_02_RESULTS: ${{ steps.task_02.outputs.result }}
          TASK_03_RESULTS: ${{ steps.task_03.outputs.result }}
        with:
          runners: task_01,task_02,task_03

  # JOB 2: Ð›Ð˜ÐÐ¢Ð•Ð Ð«
  code-quality-analysis:
    name: ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
    runs-on: ubuntu-latest
    if: always()
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      - name: Install linters
        run: pip install pylint flake8 ruff -q
      - name: Run code analysis
        run: python3 tools/code_analysis.py >> $GITHUB_STEP_SUMMARY
